<!doctype html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/add_team.css' %}">

    <style>
        table, thead, tbody, tr, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        table {
            width: 100%;
        }

        td {
            text-align: center;
        }

        td > input {
            border: none;
            background-color: inherit;
            width: calc(100% - 10px);
            height: 100%;
            text-align: center;
        }
    </style>

    <title>Document</title>
</head>
<body>

    <div class="navbar">
        <a class="menu-item" href="/">КнАГУ EVENT MANAGER</a>
    </div>
    <div class="content">

        <h1>Оценивание {{ event.name }}</h1>

        <table>
            <thead>
                <tr>
                    <th>Название команды</th>
                    <th>Прогресс</th>
                    <th>Баллы</th>
                </tr>
            </thead>
            <tbody id="res-tb">

            </tbody>
        </table>

    </div>

    <script>

        function crete_row(data) {
			return `<tr>
                        <td>${data['name']}</td>
                        <td id="2"
                            style="background: linear-gradient(to right, lightgreen 0px, lightgreen ${data['perc']}%, gray ${data['perc']}%, gray 100%); width: 80%; height: 30px;"></td>
                        <td>${data['score']} / ${data['max_score']}</td>
                    </tr>`
        }

		async function sleep(milliseconds) {
            const date = Date.now();
            let currentDate = null;
            do {
                currentDate = Date.now();
            } while (currentDate - date < milliseconds);
        }

		let pages = null

        function get_pages() {
			let xhr = new XMLHttpRequest()
            xhr.open('GET', '/get_results/{{ event.id }}', true)
			xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
            xhr.responseType = 'json'

            xhr.onload = () => {
				if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {

					pages = xhr.response['data']

                }
            }

			xhr.send()

        }

		get_pages()

		let counter = 0
        function print_data() {

			let new_body = ''

			pages[counter].forEach((team) => {
				new_body += crete_row(team)
            })

            if (counter === pages.length - 1) {
				get_pages()
				counter = 0
            } else {
				counter++
            }

            document.getElementById('res-tb').innerHTML = new_body

        }

		setTimeout(print_data, 1000)
		setInterval(print_data, 5000)

    </script>

</body>
</html>
